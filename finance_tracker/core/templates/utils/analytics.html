{% extends "base.html" %}
{% block content %}
<h2>Аналитика</h2>
<form method="get">
  <select name="period">
    <option value="day" {% if request.GET.period == 'day' %}selected{% endif %}>День</option>
    <option value="week" {% if request.GET.period == 'week' %}selected{% endif %}>Неделя</option>
    <option value="month" {% if request.GET.period == 'month' %}selected{% endif %}>Месяц</option>
    <option value="year" {% if request.GET.period == 'year' %}selected{% endif %}>Год</option>
  </select>
  <button type="submit">Показать</button>
</form>
<h3>Доходы и расходы по времени</h3>
{% if img_income_expense %}
  <img src="data:image/png;base64,{{ img_income_expense }}">
{% else %}
  <p>Нет данных для отображения</p>
{% endif %}
<h3>Расходы по категориям</h3>
{% if img_expense_pie %}
  <img src="data:image/png;base64,{{ img_expense_pie }}">
{% else %}
  <p>Нет данных для отображения</p>
{% endif %}
<h3>Статистика</h3>
<p>Доходы: {{ stats.total_income }}</p>
<p>Расходы: {{ stats.total_expense }}</p>
<p>Баланс: {{ stats.balance }}</p>

<h3>Отчёт по категориям</h3>
<table>
  <tr><th>Категория</th><th>Сумма</th></tr>
  {% for row in category_stats %}
    <tr>
      <td>{{ row.category }}</td>
      <td>{{ row.amount }}</td>
    </tr>
  {% empty %}
    <tr><td colspan="2">Нет данных</td></tr>
  {% endfor %}
</table>

{% if anomalies %}
  <h4>Аномалии:</h4>
  <ul>
  {% for a in anomalies %}
    <li>{{ a }}</li>
  {% endfor %}
  </ul>
{% endif %}

{% if advices %}
  <h4>Советы:</h4>
  <ul>
  {% for a in advices %}
    <li>{{ a }}</li>
  {% endfor %}
  </ul>
{% endif %}

{% if warning %}
      <div class="alert alert-warning">{{ warning }}</div>
   {% endif %}
   {% if income_expense_plot %}
      <img src="data:image/png;base64,{{ income_expense_plot }}" />
   {% endif %}
   {% if expense_pie_plot %}
      <img src="data:image/png;base64,{{ expense_pie_plot }}" />
   {% endif %}
{% endblock %}
